appId: com.turboiam.agent
productName: TurboIAM Agent
copyright: Copyright © 2025 TurboIAM

# Clean filenames (no spaces, consistent format)
artifactName: turboiam-agent-${version}-${arch}.${ext}

# GitHub Releases — used by electron-builder --publish and auto-updater
publish:
  provider: github
  owner: gauravpassi
  repo: upcore-agent
  releaseType: release

# Output directory for built installers
directories:
  output: dist-electron
  buildResources: assets

# Files to include in the app bundle
files:
  - electron/dist/**
  - node_modules/electron-store/**
  - package.json

# Extra resources bundled alongside the app (accessible via process.resourcesPath)
extraResources:
  - from: server/dist
    to: server/dist
    filter:
      - "**/*.js"
      - "**/*.json"
  - from: frontend/dist
    to: frontend/dist
  - from: context
    to: context

# Post-pack hook: ad-hoc signs the .app so Apple Silicon doesn't show "damaged"
afterPack: scripts/afterPack.js

# macOS
mac:
  icon: assets/icon.icns
  category: public.app-category.developer-tools
  target:
    - target: dmg
      arch:
        - x64
        - arm64
  # identity: null  → don't look for an Apple Developer certificate (ad-hoc via afterPack)
  identity: null
  hardenedRuntime: false
  gatekeeperAssess: false

dmg:
  title: TurboIAM-Agent-${version}
  # No Applications symlink — it causes hdiutil detach to fail on GitHub Actions
  # runners due to the symlink keeping the volume busy during unmount.
  # Users drag the .app to Applications manually (standard macOS behavior).
  contents:
    - x: 192
      y: 220
      type: file

# Windows
win:
  icon: assets/icon.ico
  target:
    - target: nsis
      arch:
        - x64

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  artifactName: turboiam-agent-setup-${version}.${ext}

# Linux
linux:
  icon: assets/icon.png
  category: Development
  target:
    - target: AppImage
      arch:
        - x64
